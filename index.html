<html>
    <head>
            <meta name="viewport" content="width=device-width, initial-scale=1">
            <link href="https://fonts.googleapis.com/css?family=Kalam&display=swap" rel="stylesheet">
            <link href="https://fonts.googleapis.com/css?family=B612&display=swap" rel="stylesheet">
            <link rel="stylesheet" type="text/css" href="style.css">
            
            <script type="text/javascript" src="bdayMeal.js"></script>
    </head>

    <body>
        <div id='search'>
            <input id="searchInput" type="text" placeholder=" search a name" maxlength="15">
        </div>
        
        <div id='view'></div>
    </body>

    <script>
        function compareNames(a, b) {
            a = a.trim();
            b = b.trim();
            const splitA = a.split(" ");
            const splitB = b.split(" ");
            const lastA = splitA[splitA.length - 1];
            const lastB = splitB[splitB.length - 1];
            if (lastA < lastB) return -1;
            if (lastA > lastB) return 1;
            return 0;
        }

        function lowerCaseNames(){
            let sorted = [];
            for (let i = 0; i < names.length; i++) sorted.push(names[i].toLowerCase());
            return sorted;
        }

        function postionOfValueInArray(value, array){
            for (let i = 0; i < array.length; i++) {
                const arrayElement = array[i];
                if (arrayElement.includes(value)) return i;
            }
            return null;
        }

        function scrollToName(name){
            const namesLowerCase = lowerCaseNames(names);
            const position =  postionOfValueInArray(name.toLowerCase(), namesLowerCase);
            if (position !== null ){
                const menuDom = document.querySelectorAll(`.menuChoice`)[position];
                window.scrollTo(0, menuDom.offsetTop - document.querySelector(`#search`).offsetHeight - 5);
            }
        }

        function center(){
            let bodyWidth = document.querySelector('body').offsetWidth;
            let menuChoiceElements = document.querySelectorAll('.menuChoice');
            // get cols
            // let cols = 0;
            // let y = 0
            // for (let i =0; i<menuChoiceElements.length; i++){
            //     let menuElement = menuChoiceElements[i];
            //     const rect = menuElement.getBoundingClientRect()
            //     if (i === 0){
            //         y = rect.y;
            //         cols++;
            //     }
            //     else if (rect.y === y){
            //         cols++;
            //     }
            //     else {
            //         break;
            //     }
            // }

            const menuWidth = 345;

            //calc cols
            const cols = Math.floor(bodyWidth / menuWidth);
            const totalMenuWidth = menuWidth * cols;

            const gutter = (bodyWidth - totalMenuWidth) / 2;

            //space menu choices evenly
            // for (let i =0; i<menuChoiceElements.length; i++){
            //     let menuElement = menuChoiceElements[i];
            //     if(i % cols === 0){
            //         menuElement.style.marginLeft =`${gutter}px`;
            //     }
                
            // }
        }

        function resizeThrottler (callback) {
            let resizeTimeout;
            if (!resizeTimeout) {
                resizeTimeout = setTimeout(function () {
                    resizeTimeout = null;
                    callback();
                }.bind(this), 1000);
            }
        }

        function onResize() {
            window.addEventListener("resize", this.resizeThrottler.bind(this, center), false);
        }

        //after dom ready
        document.querySelector(`#searchInput`).addEventListener('input', function(event){
            scrollToName(event.srcElement.value);
        }.bind(this));

        onResize();

        const mainId = 'view';

        const choices = JSON.parse(window.bdayMeal);
        let names = Object.keys(choices)
        names.sort(compareNames);

        let menuHtml = '';

        for (let i=0; i<names.length; i++){
            const name = names[i];
            const starter = choices[name].starter.join(', ');
            const main = choices[name].main.join(', ');
            const desert = choices[name].desert.join(', ');
            const notes = choices[name].notes.join(', ');
            const empty = '&nbsp';
            const html = 
                `<div class="menuChoice">
                 <div class="name">${name.toUpperCase()}</div>
                 <div class="field">Starter</div>
                 <div class="meal">${starter == '' ? empty: starter}</div>
                 <div class="field">Main</div>
                 <div class="meal">${main == '' ? empty: main}</div>
                 <div class="field">Desert</div>
                 <div class="meal">${desert == '' ? empty: desert}</div>
                 <div class="field">Notes</div>
                 <div class="notes">${notes == '' ? empty: notes}</div>
                </div>`;
            menuHtml += html;
        }

        document.querySelector(`#${mainId}`).innerHTML = menuHtml;
    </script>
</html>



