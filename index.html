<html>
    <head>
            <meta name="viewport" content="width=device-width, initial-scale=1">
            <link href="https://fonts.googleapis.com/css?family=Kalam&display=swap" rel="stylesheet">
            <link href="https://fonts.googleapis.com/css?family=B612&display=swap" rel="stylesheet">
            <link rel="stylesheet" type="text/css" href="style.css">
            
            <script type="text/javascript" src="bdayMeal.js"></script>
    </head>

    <body>
        <div id='search'>
            <input id="searchInput" type="text" placeholder=" search a name" maxlength="15">
        </div>
        
        <div id='view'></div>
    </body>

    <script>
        function compareNames(a, b) {
            a = a.trim();
            b = b.trim();
            const splitA = a.split(" ");
            const splitB = b.split(" ");
            const lastA = splitA[splitA.length - 1];
            const lastB = splitB[splitB.length - 1];
            if (lastA < lastB) return -1;
            if (lastA > lastB) return 1;
            return 0;
        }

        function lowerCaseNames(){
            let sorted = [];
            for (let i = 0; i < names.length; i++) sorted.push(names[i].toLowerCase());
            return sorted;
        }

        function postionOfValueInArray(value, array){
            for (let i = 0; i < array.length; i++) {
                const arrayElement = array[i];
                if (arrayElement.includes(value)) return i;
            }
            return null;
        }

        function scrollToName(name){
            const namesLowerCase = lowerCaseNames(names);
            const position =  postionOfValueInArray(name.toLowerCase(), namesLowerCase);
            if (position !== null ){
                const menuDom = document.querySelectorAll(`.menuChoice`)[position];
                window.scrollTo(0, menuDom.offsetTop - document.querySelector(`#search`).offsetHeight);
            }
        }

        //after dom ready
        document.querySelector(`#searchInput`).addEventListener('input', function(event){
            scrollToName(event.srcElement.value);
        }.bind(this));

        const mainId = 'view';

        const choices = JSON.parse(window.bdayMeal);
        let names = Object.keys(choices)
        names.sort(compareNames);

        let menuHtml = '';

        for (let i=0; i<names.length; i++){
            const name = names[i];
            const starter = choices[name].starter.join(', ');
            const main = choices[name].main.join(', ');
            const desert = choices[name].desert.join(', ');
            const notes = choices[name].notes.join(', ');
            const empty = '&nbsp';
            const html = 
                `<div class="menuChoice">
                 <div class="name">${name.toUpperCase()}</div>
                 <div class="field">Starter</div>
                 <div class="meal">${starter == '' ? empty: starter}</div>
                 <div class="field">Main</div>
                 <div class="meal">${main == '' ? empty: main}</div>
                 <div class="field">Desert</div>
                 <div class="meal">${desert == '' ? empty: desert}</div>
                 <div class="field">Notes</div>
                 <div class="notes">${notes == '' ? empty: notes}</div>
                </div>`;
            menuHtml += html;
        }

        document.querySelector(`#${mainId}`).innerHTML = menuHtml;
    </script>
</html>



